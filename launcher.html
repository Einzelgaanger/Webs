<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Performance Tracker Launcher</title>
    <link rel="icon" href="generated-icon.png" type="image/png">
    <style>
        :root {
            --primary: #7c3aed;
            --primary-dark: #6d28d9; 
            --primary-light: #a78bfa;
            --primary-very-light: #ede9fe;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --gray: #6b7280;
            --gray-light: #e5e7eb;
            --gray-dark: #374151;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }
        
        body {
            background-color: #f9fafb;
            color: #1f2937;
            line-height: 1.6;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        h1 {
            color: var(--primary);
            margin-bottom: 10px;
            font-size: 2.2rem;
        }
        
        h2 {
            color: var(--gray-dark);
            margin: 25px 0 15px;
            font-size: 1.5rem;
        }
        
        p {
            margin-bottom: 15px;
            color: var(--gray-dark);
        }
        
        .btn {
            display: inline-block;
            padding: 10px 20px;
            border-radius: 5px;
            font-weight: 600;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }
        
        .btn-primary {
            background-color: var(--primary);
            color: white;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
        }
        
        .btn-secondary {
            background-color: white;
            color: var(--primary);
            border: 1px solid var(--primary);
        }
        
        .btn-secondary:hover {
            background-color: var(--primary-very-light);
        }
        
        .btn-success {
            background-color: var(--success);
            color: white;
        }
        
        .btn-success:hover {
            opacity: 0.9;
        }
        
        .btn-danger {
            background-color: var(--danger);
            color: white;
        }
        
        .btn-danger:hover {
            opacity: 0.9;
        }
        
        .btn-info {
            background-color: var(--info);
            color: white;
        }
        
        .btn-info:hover {
            opacity: 0.9;
        }
        
        .action-panel {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .status-panel {
            background-color: var(--primary-very-light);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.online {
            background-color: var(--success);
        }
        
        .status-indicator.offline {
            background-color: var(--danger);
        }
        
        .status-indicator.loading {
            background-color: var(--warning);
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.3; }
            100% { opacity: 1; }
        }
        
        .tabs {
            margin-top: 20px;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--gray-light);
        }
        
        .tab-btn {
            padding: 10px 20px;
            background: none;
            border: none;
            cursor: pointer;
            font-weight: 600;
            color: var(--gray);
            position: relative;
        }
        
        .tab-btn.active {
            color: var(--primary);
        }
        
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 0;
            width: 100%;
            height: 2px;
            background-color: var(--primary);
        }
        
        .tab-content {
            display: none;
            padding: 15px 0;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .logs {
            background-color: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 6px;
            height: 300px;
            overflow-y: auto;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
            white-space: pre-wrap;
            margin-top: 10px;
        }
        
        .status-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            margin-left: 8px;
            vertical-align: middle;
        }
        
        .status-badge.success {
            background-color: var(--success);
            color: white;
        }
        
        .status-badge.error {
            background-color: var(--danger);
            color: white;
        }
        
        .status-badge.warning {
            background-color: var(--warning);
            color: white;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-card {
            background-color: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--gray-light);
        }
        
        .stat-title {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 5px;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--gray-dark);
        }
        
        .notice {
            background-color: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 10px 15px;
            margin: 15px 0;
            border-radius: 0 6px 6px 0;
        }
        
        .footer {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 1px solid var(--gray-light);
            color: var(--gray);
            font-size: 0.9rem;
            text-align: center;
        }

        /* Loading spinner */
        .spinner {
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            display: inline-block;
            vertical-align: middle;
            margin-right: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .btn.loading {
            pointer-events: none;
            opacity: 0.8;
        }

        /* Alert styles */
        .alert {
            padding: 12px 15px;
            border-radius: 5px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .alert-success {
            background-color: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }

        .alert-error {
            background-color: #fee2e2;
            color: #b91c1c;
            border-left: 4px solid #ef4444;
        }

        .alert-warning {
            background-color: #fef3c7;
            color: #92400e;
            border-left: 4px solid #f59e0b;
        }

        .alert-info {
            background-color: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }

        .alert-icon {
            margin-right: 10px;
            font-size: 18px;
        }

        .hidden {
            display: none;
        }

        #statusPollingIndicator {
            font-size: 10px;
            color: var(--gray);
            margin-top: 5px;
        }

        .logo {
            max-width: 80px;
            margin-bottom: 10px;
        }

        /* Animated Hover */
        .btn-primary {
            position: relative;
            overflow: hidden;
        }

        .btn-primary::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px;
            height: 5px;
            background: rgba(255, 255, 255, 0.5);
            opacity: 0;
            border-radius: 100%;
            transform: scale(1, 1) translate(-50%);
            transform-origin: 50% 50%;
        }

        .btn-primary:hover::after {
            animation: ripple 1s ease-out;
        }

        @keyframes ripple {
            0% {
                transform: scale(0, 0);
                opacity: 0.5;
            }
            100% {
                transform: scale(100, 100);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <img src="generated-icon.png" alt="Performance Tracker Logo" class="logo">
            <h1>Student Performance Tracker</h1>
            <p>Launch and manage your Student Performance Tracker application</p>
        </header>
        
        <div id="alertContainer" class="hidden"></div>
        
        <div class="status-panel">
            <h2>Server Status</h2>
            <p>
                <span class="status-indicator loading" id="serverStatusIndicator"></span>
                <span id="serverStatus">Checking server status...</span>
                <div id="statusPollingIndicator">Auto-refreshing status every 10 seconds</div>
            </p>
        </div>
        
        <div class="action-panel">
            <button id="startButton" class="btn btn-primary">
                <span id="startButtonText">Start Server</span>
            </button>
            <button id="openAppButton" class="btn btn-success" disabled>Open Application</button>
            <button id="checkButton" class="btn btn-secondary">Refresh Status</button>
        </div>
        
        <div class="tabs">
            <div class="tab-buttons">
                <button class="tab-btn active" data-tab="overview">Overview</button>
                <button class="tab-btn" data-tab="logs">Server Logs</button>
                <button class="tab-btn" data-tab="system">System Info</button>
                <button class="tab-btn" data-tab="database">Database</button>
            </div>
            
            <div class="tab-content active" id="overview">
                <h2>Server Overview</h2>
                <p>This dashboard allows you to manage the Student Performance Tracker application.</p>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-title">Server Version</div>
                        <div class="stat-value" id="serverVersion">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Server Uptime</div>
                        <div class="stat-value" id="serverUptime">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Users</div>
                        <div class="stat-value" id="userCount">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Units</div>
                        <div class="stat-value" id="unitCount">-</div>
                    </div>
                </div>
                
                <div class="notice">
                    <strong>Important:</strong> Default password for all accounts is <code>sds#website</code>
                </div>
            </div>
            
            <div class="tab-content" id="logs">
                <h2>Server Logs</h2>
                <p>Review the most recent server logs to diagnose issues:</p>
                <div class="action-panel">
                    <button id="refreshLogsButton" class="btn btn-info">Refresh Logs</button>
                </div>
                <pre class="logs" id="serverLogs">Loading logs...</pre>
            </div>
            
            <div class="tab-content" id="system">
                <h2>System Information</h2>
                <p>System details of the host running the application:</p>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-title">Platform</div>
                        <div class="stat-value" id="systemPlatform">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Architecture</div>
                        <div class="stat-value" id="systemArch">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">CPU Cores</div>
                        <div class="stat-value" id="systemCPUs">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Node.js Version</div>
                        <div class="stat-value" id="nodeVersion">-</div>
                    </div>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-title">Memory Total</div>
                        <div class="stat-value" id="memoryTotal">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Memory Free</div>
                        <div class="stat-value" id="memoryFree">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Memory Usage</div>
                        <div class="stat-value" id="memoryUsage">-</div>
                    </div>
                </div>
            </div>
            
            <div class="tab-content" id="database">
                <h2>Database Status</h2>
                <p>Information about the PostgreSQL database:</p>
                <div class="action-panel">
                    <button id="refreshDbButton" class="btn btn-info">Refresh Database Status</button>
                </div>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-title">Connection Status</div>
                        <div class="stat-value" id="dbConnection">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Users Table</div>
                        <div class="stat-value" id="dbUsers">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-title">Units Table</div>
                        <div class="stat-value" id="dbUnits">-</div>
                    </div>
                </div>
                <div id="dbErrorContainer" class="alert alert-error hidden">
                    <div class="alert-icon">⚠️</div>
                    <div id="dbErrorMessage"></div>
                </div>
            </div>
        </div>
        
        <div class="footer">
            <p>&copy; 2025 Performance Tracker | Developed by 𝐌𝐚𝐯𝐞𝐫𝐢𝐜𝐤 | April 1, 2025</p>
        </div>
    </div>
    
    <script>
        // API endpoints
        const API_BASE = 'StudentPerformanceTracker006';
        const API_STATUS = `${API_BASE}/api/status`;
        const API_START = `${API_BASE}/api/start`;
        const API_LOGS = `${API_BASE}/api/logs`;
        const API_SYSTEM = `${API_BASE}/api/system`;
        const API_DATABASE = `${API_BASE}/api/database`;
        
        // Elements
        const serverStatusIndicator = document.getElementById('serverStatusIndicator');
        const serverStatus = document.getElementById('serverStatus');
        const startButton = document.getElementById('startButton');
        const startButtonText = document.getElementById('startButtonText');
        const openAppButton = document.getElementById('openAppButton');
        const checkButton = document.getElementById('checkButton');
        const serverLogs = document.getElementById('serverLogs');
        const refreshLogsButton = document.getElementById('refreshLogsButton');
        const refreshDbButton = document.getElementById('refreshDbButton');
        const alertContainer = document.getElementById('alertContainer');
        
        // Tab functionality
        const tabButtons = document.querySelectorAll('.tab-btn');
        const tabContents = document.querySelectorAll('.tab-content');
        
        tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                // Remove active class from all buttons and contents
                tabButtons.forEach(btn => btn.classList.remove('active'));
                tabContents.forEach(content => content.classList.remove('active'));
                
                // Add active class to clicked button and corresponding content
                button.classList.add('active');
                const tabId = button.dataset.tab;
                document.getElementById(tabId).classList.add('active');
                
                // Load content based on tab
                if (tabId === 'logs') {
                    fetchLogs();
                } else if (tabId === 'system') {
                    fetchSystemInfo();
                } else if (tabId === 'database') {
                    fetchDatabaseStatus();
                }
            });
        });
        
        // Helper functions
        function formatBytes(bytes, decimals = 2) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
        }
        
        function formatUptime(seconds) {
            const days = Math.floor(seconds / 86400);
            const hours = Math.floor((seconds % 86400) / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const remainingSeconds = Math.floor(seconds % 60);
            
            let result = '';
            if (days > 0) result += `${days}d `;
            if (hours > 0 || days > 0) result += `${hours}h `;
            if (minutes > 0 || hours > 0 || days > 0) result += `${minutes}m `;
            result += `${remainingSeconds}s`;
            
            return result;
        }
        
        function showAlert(message, type = 'info') {
            alertContainer.innerHTML = `
                <div class="alert alert-${type}">
                    <div class="alert-icon">${type === 'success' ? '✅' : type === 'error' ? '❌' : type === 'warning' ? '⚠️' : 'ℹ️'}</div>
                    <div>${message}</div>
                </div>
            `;
            alertContainer.classList.remove('hidden');
            
            // Auto-hide after 5 seconds for success messages
            if (type === 'success') {
                setTimeout(() => {
                    alertContainer.classList.add('hidden');
                }, 5000);
            }
        }
        
        function setLoading(button, isLoading) {
            if (isLoading) {
                button.classList.add('loading');
                button.innerHTML = `<span class="spinner"></span> ${button.textContent}`;
                button.disabled = true;
            } else {
                button.classList.remove('loading');
                button.innerHTML = button.textContent;
                button.disabled = false;
            }
        }
        
        // API functions
        async function checkServerStatus() {
            try {
                serverStatusIndicator.className = 'status-indicator loading';
                serverStatus.textContent = 'Checking server status...';
                
                const response = await fetch(API_STATUS);
                
                if (response.ok) {
                    const data = await response.json();
                    serverStatusIndicator.className = 'status-indicator online';
                    serverStatus.textContent = 'Server is running';
                    startButton.disabled = true;
                    openAppButton.disabled = false;
                    
                    // Update overview stats
                    document.getElementById('serverVersion').textContent = data.version || '-';
                    document.getElementById('serverUptime').textContent = formatUptime(data.uptime);
                    
                    if (data.database && data.database.connected) {
                        document.getElementById('userCount').textContent = data.database.users || '-';
                        document.getElementById('unitCount').textContent = data.database.units || '-';
                    }
                    
                    return true;
                } else {
                    serverStatusIndicator.className = 'status-indicator offline';
                    serverStatus.textContent = 'Server is not running';
                    startButton.disabled = false;
                    openAppButton.disabled = true;
                    
                    // Reset overview stats
                    document.getElementById('serverVersion').textContent = '-';
                    document.getElementById('serverUptime').textContent = '-';
                    document.getElementById('userCount').textContent = '-';
                    document.getElementById('unitCount').textContent = '-';
                    
                    return false;
                }
            } catch (error) {
                console.error('Error checking server status:', error);
                serverStatusIndicator.className = 'status-indicator offline';
                serverStatus.textContent = 'Server is not running';
                startButton.disabled = false;
                openAppButton.disabled = true;
                return false;
            }
        }
        
        async function startServer() {
            try {
                setLoading(startButton, true);
                startButtonText.textContent = 'Starting Server...';
                
                const response = await fetch(API_START, {
                    method: 'POST',
                });
                
                if (response.ok) {
                    showAlert('Server starting. Please wait a moment...', 'success');
                    
                    // Wait a few seconds and then check status
                    setTimeout(async () => {
                        const isRunning = await checkServerStatus();
                        if (isRunning) {
                            showAlert('Server started successfully!', 'success');
                        } else {
                            showAlert('Server may not have started properly. Check logs for details.', 'warning');
                        }
                        setLoading(startButton, false);
                        startButtonText.textContent = 'Start Server';
                    }, 5000);
                } else {
                    const errorData = await response.json();
                    showAlert(`Error starting server: ${errorData.error || 'Unknown error'}`, 'error');
                    setLoading(startButton, false);
                    startButtonText.textContent = 'Start Server';
                }
            } catch (error) {
                console.error('Error starting server:', error);
                showAlert(`Failed to start server: ${error.message}`, 'error');
                setLoading(startButton, false);
                startButtonText.textContent = 'Start Server';
            }
        }
        
        async function fetchLogs() {
            try {
                serverLogs.textContent = 'Loading logs...';
                
                const response = await fetch(API_LOGS);
                
                if (response.ok) {
                    const data = await response.json();
                    serverLogs.textContent = data.content || 'No logs available.';
                } else {
                    serverLogs.textContent = 'Failed to load logs. Server may not be running.';
                }
            } catch (error) {
                console.error('Error fetching logs:', error);
                serverLogs.textContent = `Error loading logs: ${error.message}`;
            }
        }
        
        async function fetchSystemInfo() {
            try {
                document.getElementById('systemPlatform').textContent = 'Loading...';
                
                const response = await fetch(API_SYSTEM);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    document.getElementById('systemPlatform').textContent = data.platform || '-';
                    document.getElementById('systemArch').textContent = data.arch || '-';
                    document.getElementById('systemCPUs').textContent = data.cpus || '-';
                    document.getElementById('nodeVersion').textContent = data.nodejs?.version || '-';
                    
                    if (data.memory) {
                        document.getElementById('memoryTotal').textContent = formatBytes(data.memory.total);
                        document.getElementById('memoryFree').textContent = formatBytes(data.memory.free);
                        
                        const usagePercent = 100 - Math.round((data.memory.free / data.memory.total) * 100);
                        document.getElementById('memoryUsage').textContent = `${usagePercent}%`;
                    }
                } else {
                    document.getElementById('systemPlatform').textContent = '-';
                    document.getElementById('systemArch').textContent = '-';
                    document.getElementById('systemCPUs').textContent = '-';
                    document.getElementById('nodeVersion').textContent = '-';
                    document.getElementById('memoryTotal').textContent = '-';
                    document.getElementById('memoryFree').textContent = '-';
                    document.getElementById('memoryUsage').textContent = '-';
                }
            } catch (error) {
                console.error('Error fetching system info:', error);
                document.getElementById('systemPlatform').textContent = 'Error';
            }
        }
        
        async function fetchDatabaseStatus() {
            try {
                document.getElementById('dbConnection').textContent = 'Checking...';
                document.getElementById('dbErrorContainer').classList.add('hidden');
                
                const response = await fetch(API_DATABASE);
                
                if (response.ok) {
                    const data = await response.json();
                    
                    if (data.connected) {
                        document.getElementById('dbConnection').textContent = 'Connected';
                        document.getElementById('dbConnection').style.color = 'var(--success)';
                        document.getElementById('dbUsers').textContent = data.users || '0';
                        document.getElementById('dbUnits').textContent = data.units || '0';
                    } else {
                        document.getElementById('dbConnection').textContent = 'Disconnected';
                        document.getElementById('dbConnection').style.color = 'var(--danger)';
                        document.getElementById('dbUsers').textContent = '-';
                        document.getElementById('dbUnits').textContent = '-';
                        
                        if (data.error) {
                            document.getElementById('dbErrorContainer').classList.remove('hidden');
                            document.getElementById('dbErrorMessage').textContent = data.error;
                        }
                    }
                } else {
                    document.getElementById('dbConnection').textContent = 'Error';
                    document.getElementById('dbConnection').style.color = 'var(--danger)';
                    document.getElementById('dbUsers').textContent = '-';
                    document.getElementById('dbUnits').textContent = '-';
                }
            } catch (error) {
                console.error('Error fetching database status:', error);
                document.getElementById('dbConnection').textContent = 'Error';
                document.getElementById('dbConnection').style.color = 'var(--danger)';
            }
        }
        
        // Event listeners
        startButton.addEventListener('click', startServer);
        openAppButton.addEventListener('click', () => {
            window.open(`/StudentPerformanceTracker006/`, '_blank');
        });
        checkButton.addEventListener('click', checkServerStatus);
        refreshLogsButton.addEventListener('click', fetchLogs);
        refreshDbButton.addEventListener('click', fetchDatabaseStatus);
        
        // Initialize
        checkServerStatus();
        
        // Poll for status
        setInterval(checkServerStatus, 10000);
    </script>
</body>
</html>